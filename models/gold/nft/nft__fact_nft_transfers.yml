version: 2

models:
  - name: nft__fact_nft_transfers
    description: |-
      Comprehensive fact table containing all NEAR Protocol NFT transfer transactions with detailed ownership change metadata and execution context. This model serves as the primary source of truth for NFT transfer data in the gold layer, providing normalized access to ownership transfers, contract interactions, and token movement patterns. The model transforms raw NFT transfer data from silver__nft_transfers into structured columns for efficient querying and analysis. It includes critical transfer information such as sender/receiver addresses, token IDs, contract addresses, and transaction context. This table is essential for NFT analytics, ownership tracking, market activity monitoring, and collection movement analysis. The data flows from blockchain transactions through silver__nft_transfers, with transfer parsing applied to extract structured ownership change data. This table represents the most comprehensive view of NFT ownership transfers on NEAR, enabling detailed analysis of trading patterns, collection liquidity, and market dynamics across all supported NFT standards.
    columns:
      - name: BLOCK_ID
        description: "{{ doc('block_id')}}"
        tests:
          - not_null
          - dbt_expectations.expect_column_values_to_be_in_type_list:
              column_type_list:
                - NUMBER
                - FLOAT

      - name: BLOCK_TIMESTAMP
        description: "{{ doc('block_timestamp')}}"
        tests:
          - dbt_expectations.expect_column_values_to_be_in_type_list:
              column_type_list:
                - TIMESTAMP_NTZ
          - not_null:
              where: inserted_timestamp >= SYSDATE() - INTERVAL '{{ var('DBT_TEST_LOOKBACK_DAYS', 14) }} days'

      - name: TX_HASH
        description: "{{ doc('tx_hash')}}"
        tests:
          - not_null

      - name: CONTRACT_ADDRESS
        description: "{{ doc('contract_address')}}"

      - name: FROM_ADDRESS
        description: "{{ doc('from_address')}}"

      - name: TO_ADDRESS
        description: "{{ doc('to_address')}}"

      - name: TOKEN_ID
        description: "{{ doc('token_id')}}"

      - name: FACT_NFT_TRANSFERS_ID
        description: "{{doc('id')}}"
        tests:
          - unique:
              where: inserted_timestamp >= SYSDATE() - INTERVAL '{{ var('DBT_TEST_LOOKBACK_DAYS', 14) }} days'
          - not_null:
              where: inserted_timestamp >= SYSDATE() - INTERVAL '{{ var('DBT_TEST_LOOKBACK_DAYS', 14) }} days'

      - name: INSERTED_TIMESTAMP
        description: "{{doc('inserted_timestamp')}}"

      - name: MODIFIED_TIMESTAMP
        description: "{{doc('modified_timestamp')}}"
