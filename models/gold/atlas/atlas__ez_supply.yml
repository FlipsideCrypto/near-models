version: 2

models:
  - name: atlas__ez_supply
    description: |-
      This easy-access table contains NEAR Protocol token supply metrics with detailed breakdowns of staked, locked, and circulating supply for economic analytics. It serves as the primary analytics-ready table for NEAR supply data in the gold layer, providing normalized access to total supply, staking distribution, lockup allocations, and circulating supply metrics. The model transforms raw supply data from silver__atlas_supply into structured columns for efficient querying and analysis. It includes critical supply information such as total supply, staked/non-staked breakdowns, locked/liquid allocations, circulating supply metrics, and percentage distributions. This table is essential for economic analytics, supply distribution analysis, staking participation monitoring, and market liquidity assessment. The data flows from supply calculation models through silver__atlas_supply, with detailed supply categorization applied to provide economic context. This table represents the most complete view of NEAR token supply dynamics, enabling detailed analysis of supply distribution, economic behavior, and market structure patterns. Note: This table is being migrated to the core schema and will be retained while other atlas tables are deprecated.
    tests:
      - dbt_utils.recency:
          datepart: days
          field: inserted_timestamp
          interval: 1
    
    columns:
      - name: UTC_DATE
        description: "{{ doc('utc_date') }}"
        tests:
          - not_null
      - name: TOTAL_SUPPLY
        description: "{{ doc('total_supply') }}"
        tests:
          - not_null
      - name: TOTAL_STAKED_SUPPLY
        description: "{{ doc('total_staked_supply') }}"
        tests:
          - not_null
      - name: TOTAL_NONSTAKED_SUPPLY
        description: "{{ doc('total_nonstaked_supply') }}"
        tests:
          - not_null
      - name: CIRCULATING_SUPPLY
        description: "{{ doc('circulating_supply') }}"
        tests:
          - not_null
      - name: TOTAL_LOCKED_SUPPLY
        description: "{{ doc('total_locked_supply') }}"
        tests:
          - not_null
      - name: LIQUID_SUPPLY
        description: "{{ doc('liquid_supply') }}"
        tests:
          - not_null
      - name: NONLIQUID_SUPPLY
        description: "{{ doc('nonliquid_supply') }}"
        tests:
          - not_null
      - name: STAKED_LOCKED_SUPPLY
        description: "{{ doc('staked_locked_supply') }}"
        tests:
          - not_null
      - name: NON_STAKED_LOCKED_SUPPLY
        description: "{{ doc('non_staked_locked_supply') }}"
        tests:
          - not_null
      - name: STAKED_CIRCULATING_SUPPLY
        description: "{{ doc('staked_circulating_supply') }}"
        tests:
          - not_null
      - name: NONSTAKED_CIRCULATING_SUPPLY
        description: "{{ doc('nonstaked_circulating_supply') }}"
        tests:
          - not_null
      - name: PERC_LOCKED_SUPPLY
        description: "{{ doc('perc_locked_supply') }}"
        tests:
          - not_null
      - name: PERC_CIRCULATING_SUPPLY
        description: "{{ doc('perc_circulating_supply') }}"
        tests:
          - not_null
      - name: PERC_STAKED_LOCKED
        description: "{{ doc('perc_staked_locked') }}"
        tests:
          - not_null
      - name: PERC_STAKED_CIRCULATING
        description: "{{ doc('perc_staked_circulating') }}"
        tests:
          - not_null
      - name: EZ_SUPPLY_ID
        description: "{{ doc('id') }}"
        tests:
          - not_null
          - unique
      - name: INSERTED_TIMESTAMP
        description: "{{ doc('inserted_timestamp') }}"

      - name: MODIFIED_TIMESTAMP
        description: "{{ doc('modified_timestamp') }}"
