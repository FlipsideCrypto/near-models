version: 2

models:
  - name: intents__fact_swaps
    description: "{{ doc('intents__fact_swaps') }}"
    tests:
      - dbt_utils.recency:
          datepart: hours
          field: block_timestamp
          interval: 12

    columns:
      - name: TX_HASH
        description: "{{ doc('tx_hash')}}"
        tests:
          - not_null:
              where: inserted_timestamp >= SYSDATE() - INTERVAL '{{ var('DBT_TEST_LOOKBACK_DAYS', 14) }} days'

      - name: RECEIPT_ID
        description: "{{ doc('receipt_id')}}"
        tests:
          - not_null:
              where: inserted_timestamp >= SYSDATE() - INTERVAL '{{ var('DBT_TEST_LOOKBACK_DAYS', 14) }} days'

      - name: BLOCK_ID
        description: "{{ doc('block_id')}}"
        tests:
          - not_null:
              where: inserted_timestamp >= SYSDATE() - INTERVAL '{{ var('DBT_TEST_LOOKBACK_DAYS', 14) }} days'

      - name: BLOCK_TIMESTAMP
        description: "{{ doc('block_timestamp')}}"
        tests:
          - not_null:
              where: inserted_timestamp >= SYSDATE() - INTERVAL '{{ var('DBT_TEST_LOOKBACK_DAYS', 14) }} days'

      - name: RECEIVER_ID
        description: "{{ doc('receiver_id')}}"
        tests:
          - not_null:
              where: inserted_timestamp >= SYSDATE() - INTERVAL '{{ var('DBT_TEST_LOOKBACK_DAYS', 14) }} days'

      - name: SIGNER_ID
        description: "{{ doc('signer_id')}}"
        tests:
          - not_null:
              where: inserted_timestamp >= SYSDATE() - INTERVAL '{{ var('DBT_TEST_LOOKBACK_DAYS', 14) }} days'

      - name: INTENT_HASH
        description: "{{ doc('intent_hash')}}"
        tests:
          - not_null:
              where: inserted_timestamp >= SYSDATE() - INTERVAL '{{ var('DBT_TEST_LOOKBACK_DAYS', 14) }} days'

      - name: ACCOUNT_ID
        description: "{{ doc('account_id_intent')}}"
        tests:
          - not_null:
              where: inserted_timestamp >= SYSDATE() - INTERVAL '{{ var('DBT_TEST_LOOKBACK_DAYS', 14) }} days'

      - name: REFERRAL
        description: "{{ doc('referral')}}"

      - name: SWAP_INDEX
        description: "{{ doc('index')}}"
        tests:
          - not_null:
              where: inserted_timestamp >= SYSDATE() - INTERVAL '{{ var('DBT_TEST_LOOKBACK_DAYS', 14) }} days'

      - name: AMOUNT_OUT_RAW
        description: "{{ doc('amount_out_raw')}}"
        tests:
          - not_null:
              where: inserted_timestamp >= SYSDATE() - INTERVAL '{{ var('DBT_TEST_LOOKBACK_DAYS', 14) }} days'

      - name: TOKEN_OUT
        description: "{{ doc('token_out')}}"
        tests:
          - not_null:
              where: inserted_timestamp >= SYSDATE() - INTERVAL '{{ var('DBT_TEST_LOOKBACK_DAYS', 14) }} days'

      - name: AMOUNT_IN_RAW
        description: "{{ doc('amount_in_raw')}}"
        tests:
          - not_null:
              where: inserted_timestamp >= SYSDATE() - INTERVAL '{{ var('DBT_TEST_LOOKBACK_DAYS', 14) }} days'

      - name: TOKEN_IN
        description: "{{ doc('token_in')}}"
        tests:
          - not_null:
              where: inserted_timestamp >= SYSDATE() - INTERVAL '{{ var('DBT_TEST_LOOKBACK_DAYS', 14) }} days'

      - name: SWAP_INPUT_DATA
        description: "{{ doc('swap_input_data')}}"

      - name: LOG
        description: "{{ doc('log')}}"

      - name: _PARTITION_BY_BLOCK_NUMBER
        description: "{{ doc('_partition_by_block_number')}}"

      - name: FACT_SWAPS_ID
        description: "{{ doc('id') }}"
        tests:
          - unique:
              where: inserted_timestamp >= SYSDATE() - INTERVAL '{{ var('DBT_TEST_LOOKBACK_DAYS', 14) }} days'
          - not_null:
              where: inserted_timestamp >= SYSDATE() - INTERVAL '{{ var('DBT_TEST_LOOKBACK_DAYS', 14) }} days'

      - name: INSERTED_TIMESTAMP
        description: "{{ doc('inserted_timestamp')}}"
        tests:
          - not_null:
              where: inserted_timestamp >= SYSDATE() - INTERVAL '{{ var('DBT_TEST_LOOKBACK_DAYS', 14) }} days'

      - name: MODIFIED_TIMESTAMP
        description: "{{ doc('modified_timestamp')}}"
        tests:
          - not_null:
              where: inserted_timestamp >= SYSDATE() - INTERVAL '{{ var('DBT_TEST_LOOKBACK_DAYS', 14) }} days'

      - name: _INVOCATION_ID
        description: "{{ doc('invocation_id')}}"
        tests:
          - not_null:
              where: inserted_timestamp >= SYSDATE() - INTERVAL '{{ var('DBT_TEST_LOOKBACK_DAYS', 14) }} days'
