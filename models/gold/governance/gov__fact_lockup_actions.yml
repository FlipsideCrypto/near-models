version: 2

models:
  - name: gov__fact_lockup_actions
    description: |-
      Comprehensive fact table containing all NEAR Protocol lockup contract disbursements with detailed vesting schedules and release timing information for governance analytics. This model serves as the primary source of truth for lockup activity data in the gold layer, providing normalized access to token disbursements, vesting schedules, and release mechanisms from the lockup.near contract. The model transforms raw lockup data from silver__lockup_actions into structured columns for efficient querying and analysis. It includes critical lockup information such as deposit amounts, lockup durations, vesting schedules, release timings, and account relationships. This table is essential for governance analytics, token release tracking, vesting schedule monitoring, and economic impact analysis. The data flows from blockchain transactions through silver__lockup_actions, with lockup contract parsing applied to extract structured disbursement data. This table represents the most comprehensive view of NEAR lockup activity, enabling detailed analysis of token release patterns, governance participation, and economic distribution mechanisms.

    columns:
      - name: TX_HASH
        description: "{{ doc('tx_hash')}}"
        tests:
          - not_null:
              where: inserted_timestamp >= SYSDATE() - INTERVAL '{{ var('DBT_TEST_LOOKBACK_DAYS', 14) }} days'

      - name: BLOCK_TIMESTAMP
        description: "{{ doc('block_timestamp')}}"
        tests:
          - not_null:
              where: inserted_timestamp >= SYSDATE() - INTERVAL '{{ var('DBT_TEST_LOOKBACK_DAYS', 14) }} days'

      - name: BLOCK_ID
        description: "{{ doc('block_id')}}"
        tests:
          - not_null

      - name: DEPOSIT
        description: "{{ doc('deposit')}}"
        tests:
          - not_null
          - dbt_expectations.expect_column_values_to_be_in_type_list:
              column_type_list:
                - DOUBLE
                - FLOAT
                - NUMBER

      - name: LOCKUP_ACCOUNT_ID
        description: "{{ doc('lockup_account_id')}}"
        tests:
          - not_null

      - name: OWNER_ACCOUNT_ID
        description: "{{ doc('owner_account_id')}}"
        tests:
          - not_null

      - name: LOCKUP_DURATION
        description: "{{ doc('lockup_duration')}}"
        tests:
          - not_null
          - dbt_expectations.expect_column_values_to_be_in_type_list:
              column_type_list:
                - VARCHAR

      - name: LOCKUP_TIMESTAMP
        description: "{{ doc('lockup_timestamp')}}"
        tests:
          - dbt_expectations.expect_column_values_to_be_in_type_list:
              column_type_list:
                - VARCHAR

      - name: LOCKUP_TIMESTAMP_NTZ
        description: "{{ doc('lockup_timestamp_ntz')}}"
        tests:
          - dbt_expectations.expect_column_values_to_be_in_type_list:
              column_type_list:
                - TIMESTAMP_NTZ

      - name: RELEASE_DURATION
        description: "{{ doc('release_duration')}}"
        tests:
          - dbt_expectations.expect_column_values_to_be_in_type_list:
              column_type_list:
                - VARCHAR

      - name: VESTING_SCHEDULE
        description: "{{ doc('vesting_schedule')}}"

      - name: TRANSFERS_INFORMATION
        description: "{{ doc('transfers_information')}}"

      - name: FACT_LOCKUP_ACTIONS_ID
        description: "{{doc('id')}}"
        tests:
          - unique:
              where: inserted_timestamp >= SYSDATE() - INTERVAL '{{ var('DBT_TEST_LOOKBACK_DAYS', 14) }} days'
          - not_null:
              where: inserted_timestamp >= SYSDATE() - INTERVAL '{{ var('DBT_TEST_LOOKBACK_DAYS', 14) }} days'

      - name: INSERTED_TIMESTAMP
        description: "{{doc('inserted_timestamp')}}"

      - name: MODIFIED_TIMESTAMP
        description: "{{doc('modified_timestamp')}}"
